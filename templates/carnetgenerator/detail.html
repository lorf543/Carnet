{% extends "base.html" %} 
{% block content %} 
{% include "components/navbar.html"%} 
{% load static %}

<style>
  .carnet_front {
    background-image: url( {% static "/img/front_background.jpeg" %} );
    background-position: center;
    background-repeat: no-repeat;
    background-size: 100% 100%;
    width: 100%;
    height: 297mm;
  }

  .carnet_back {
    background-image: url( {% static "/img/back_background.jpeg" %} );
    background-position: center;
    background-repeat: no-repeat;
    background-size: 100% 100%;
    width: 100%;
    height: 297mm;
  }
</style>

<div class="mt-5 ms-5">
  <button class="btn btn-success my-2" type="button" onclick="generatePDF();">
    Imprimir
  </button>
  {% if user.is_superuser %}
  <a
    href="{% url 'agent_update' agent.id %}"
    class="h6 link-success link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"
    >Editar</a
  >
  {% endif %} -
  <a
    class="h6 link-success link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"
    href="{% url 'home' %}">Back</a
  >
</div>

<div id="pageprint">
  <div class="book">
    <div class="page carnet_front">
      <div class="container-carnet">
        <header>
          <div class="logo">
            <img src="{% static '/img/logo-CUSEP.png' %}" alt="logo cusep" />
          </div>
          <div class="title-header">
            <div class="siglas">CUSEP</div>
            <div class="titulo">CUERPO DE SEGURIDAD PRESIDENCIAL</div>
          </div>
        </header>

        <div class="profile_picture">
          <img src={{agent.profile_picture.url}} alt="" />
        </div>

        <div class="personal_info">
          <p class="firstname">Espirtud Santo Martinez</p>
          <p class="lastname">Mara De La Altagracia</p>
          <p class="rango">Mayor, erd</p>
          <p class="id_carnet">251436</p>
          <div class="logo_army">
            <img src="{% static '/img/Fuerzas Armadas.png' %}" alt="" />
          </div>
        </div>

        <footer>
          <h2>Contratado</h2>
        </footer>

      </div>
    </div>
    <div class="page carnet_back">

      <div class="escudos">
        <div class="ejercito_escudo">
          <img src="{% static '/img/Ejercito.png' %}" alt="" />
        </div>
        <div class="armada_escudo">
          <img src="{% static '/img/Armada.png' %}" alt="" />
        </div>
        <div class="area_escudo">
          <img src="{% static '/img/Area.png' %}" alt="" />
        </div>
        <div class="policia_escudo">
          <img src="{% static '/img/Policia_nacional_emblema.png' %}" alt="" />
        </div>
      </div>

      <header class="mt-4">
        <p>DATOS PERSONALES</p>
        <div class="verticalLine"></div>
      </header>
  
      <div class="personal_information">
        <div class="campos-l">
          <div class="cedula">cedula:</div>
          <div class="estatura">estatura:</div>
          <div class="ojos">ojos:</div>
          <div class="color">color de piel:</div>
          <div class="peso">peso:</div>
          <div class="sagre">tipo de sangre:</div>
        </div>
  
        <div class="campos-r">
          <div class="">{{agent.identification}}</div>
          <div class="">{{agent.height}}"</div>
          <div class="">{{agent.eyes}}</div>
          <div class="">{{agent.skin}}</div>
          <div class="">{{agent.weight}}lb</div>
          <div class="">{{agent.blood_type}}</div>
        </div>
      </div>
  
      <div class="advertencia">
        <h2>advertencia</h2>
        <p>
          Si encuentra este carnet entreguelo al puesto militar o policial mas cercano o llamenos al 809-688-6461
        </p>
      </div>
  
      <div class="validar">
        <div>
          <p class="fecha">Expedido:25/09/2022</p>
          <div class="qr"><img src="{{agent.qr_code.url}}" alt=""></div>
        </div>
        <div class="firma">
          <div class="firma_linea"></div>
          <div class="firma_letra">Firma Autorizada</div>
        </div>
      </div>
    </div>

    </div>
  </div>


  
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<!-- Script para generar el PDF -->
<script>
  function getImageDataUrl(url, callback) {
    var img = new Image();
    img.crossOrigin = 'Anonymous'; // Esto es necesario para evitar problemas de CORS
    img.onload = function() {
      var canvas = document.createElement('canvas');
      var ctx = canvas.getContext('2d');
      canvas.height = this.naturalHeight;
      canvas.width = this.naturalWidth;
      ctx.drawImage(this, 0, 0);
      var dataURL = canvas.toDataURL('image/png');
      callback(dataURL); // Llamamos al callback con la Data URL de la imagen
    };
    img.src = url;
  }
  
  function generatePDF() {
    const element = document.getElementById("pageprint");
    
    // Asumiendo que tienes un array con las URLs de tus im치genes
    var imagesToLoad = ['URL_IMAGEN_1', 'URL_IMAGEN_2', ...];
    var loadedImagesCount = 0;
    
    imagesToLoad.forEach(function(imageUrl) {
      getImageDataUrl(imageUrl, function(dataUrl) {
        // Reemplaza la fuente de la imagen en tu elemento con la Data URL
        var imgElements = element.querySelectorAll('img');
        for (var i = 0; i < imgElements.length; i++) {
          if (imgElements[i].src === imageUrl) {
            imgElements[i].src = dataUrl;
          }
        }
        
        // Verifica si todas las im치genes han sido procesadas
        loadedImagesCount++;
        if (loadedImagesCount === imagesToLoad.length) {
          // Todas las im치genes est치n listas, genera el PDF
          var options = {
            margin: [-1, -4, 0, 0],
            filename: "documento.pdf",
            image: { type: "jpeg", quality: 0.9 },
            html2canvas: {
              scale: 2,
              letterRendering: true,
            },
            jsPDF: {
              unit: "mm",
              format: "a4",
              orientation: "portrait",
            },
          };
          
          html2pdf().from(element).set(options).output('dataurlnewwindow');
        }
      });
    });
  }
</script>

{% endblock content %}
